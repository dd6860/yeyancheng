<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="lib/bootstrap-3.3.7-dist/css/bootstrap.css">
    <script src="lib/jquery-3.2.1.js"></script>
	<script src="lib/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <script src="lib/jquery-lxzoom/jquery.lxzoom.js"></script>
    <style>
/* <!-- 上部分 --> */
        .container{width: 1200px;padding:0 auto;}
        .dl_logo img{height: 36px; margin:12px 0;}
        .dl2{background-color: #F7F2EC;}
        .dl2>.container{background:url("img/dl_img.png") no-repeat;position: relative;}
/* ======中1========================== */
        .dl_main{height: 615px;width: 430px;float:right;background-color: #fff;margin-top: 40px;}
        .dl_top{height: 62px;}
        .dl_top>span{text-align: center;line-height: 62px;font-size: 20px;color: #AFB4BE;border-bottom: 3px solid #fff;margin-bottom: 30px;}
        .dl_top>.dl_act{color: #000;border-bottom: 3px solid #000;}
/* <!-- ====中二======== --> */
        .dl_l,.dl_r,.dl_b{width: 375px;margin:0 auto;overflow: hidden;}
        .dl_l input{margin-bottom: 20px;}
        .dl_l .msg{margin-top: 5px;}
        .dl_l .dl_getmsg{margin-top: 5px;}

        .dl_r>input{margin-bottom: 25px;}
        .dl_tips a{float:right;}
        .dl_tips .dl_zc{float:right;color:#000;}

        .dl_tips div{float:right;}
        .dl_tips span{float:left;color:red;}   
        .dl_r{margin-bottom: 5px;}     
/* 中三 */   
        .dl_btn{border-radius: 30px;font-size: 24px;margin:20px 0;}    
        .dl_b>.dl_fg span{display:block;text-align: center;margin-bottom: 10px;}
        .dl_b>p{text-align: center;display: block;}  
        .dl_b ul {overflow: hidden;}
        .dl_b ul li{float:left;}
        .dl_b ul li img{width: 40px;height: 40px;margin:0 17px;}  
        .dl_b .agree{margin-top: 20px;text-align: center;}
        .dl_sm{position: absolute;right: 80px;bottom: 50px;}
/* ================ */
        .dl3_b img{display: inline-block;}
        .dl3_a,.dl3_b>p{text-align: center;margin-top:5px;font-size: 18px;}
        .ewm_x{width: 50px;height: 50px;position: absolute;right: 18px;bottom: 0;}
        .footer0104{width: 150px;height: 150px;position: absolute;right: 18px;bottom: 0;display: none;}
        .qitian{position: absolute;right: 75px;bottom: 330px;font-size: 14px;}
        .qitian input{display: inline-block;}
        .dl_l{display: none;}
        .dl_tips2{margin-top: 161px;}
    </style>
</head>
<body>
    <div class="dl1">
        <div class="container">
            <!-- 顶部logo -->
            <div class="dl_logo">
                    <img src="img/logo.png" alt="">
            </div>
        </div>
    </div>
    <div class="dl2">
        <div class="container ">    
            <!-- 登录框 -->
            <div class="dl_main">
                <!-- 顶部按键 -->
                <div class="dl_top">
                    <span class=" col-sm-6 dxdl">注册账号</span>
                    <span class="dl_act col-sm-6 mmdl">账号登录</span>
                </div>
                <!-- 弹出框1 -->
                <div class="dl_l" >
                    <input type="text" class="phone col-sm-12 input-lg" placeholder="用户名">
                    <input type="password" class="msg col-sm-12 input-lg" placeholder="密码" style="margin-bottom: 39px;">
                    <span style="color:red;">&nbsp;</span>
                    <div class="dl_tips">
                        <p><span style="display: none;">验证码不正确，请重新获取验证码</span> </p>
                    </div>
                </div>  
                <!-- 弹出框2 -->
                <div class="dl_r">
                    <input type="text" class="dl_usm col-sm-12 input-lg" value="laoxie">
                    <input type="password" class="psd input-lg col-sm-12 " placeholder="密码" value="">
                    <div class="dl_tips dl_tips2">
                        <p><span class="yincang">&nbsp;</span>
                            
                            <span href="" class="dl_zc">忘记密码</span></p> 
                    </div>
                </div>
                <div class="wangji" style="width: 600px;height: 350px;position: absolute;left: 50%;top: 50%;transform: translate(-50%,-50%);background-color: #eee;z-index: 10000;border:3px solid orange;padding:20px; display:none;">
                    <h1>找回密码</h1>
                    <input type="text" class="username_zh form-control input-lg" placeholder="请输入你的账号" style="margin:20px 0;" value="laoxie">
                    <input type="text" class="phone_zh form-control input-lg" placeholder="请输入你的手机号码" style="margin:20px 0;" value="13333333333">
                    <input type="text" class="npsd1 form-control input-lg" placeholder="请输入需要设置的密码" style="margin:20px 0;display: none;" value="123456">
                    <input type="text" class="npsd2 form-control input-lg" placeholder="请再次输入需要设置的密码" style="margin:20px 0;display: none;"value="123456">
                    <p class="logints" style="color:red;font-size: 20px">&nbsp;</p>
                    <button class="tijiao1 btn-lg btn-success"style="position: absolute;right: 50px;bottom: 50px;width: 150px;">提交</button>
                    <button class="tijiao2 btn-lg btn-success"style="position: absolute;right: 50px;bottom: 50px;width: 150px;display: none;">提交设置</button>
                    <button class="guanbi" style="position: absolute;right: 10px;top: 10px;">x</button>
                </div>
                <!-- 登录框底部 -->
                <div class="dl_b">
                    <button class="dl_btn btn btn-lg col-sm-12 btn-danger">登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;录</button>
                    <div class="dl_fg"><span>合作网站账号登录</span></div>
                    <ul>
                        <li><img src="img/dl_1.png" alt=""></li>
                        <li><img src="img/dl_2.png" alt=""></li>
                        <li><img src="img/dl_3.png" alt=""></li>
                        <li><img src="img/dl_4.png" alt=""></li>
                        <li><img src="img/dl_5.png" alt=""></li>
                    </ul>
                    <div class="dl_b agree">登录代表您已同意<a href="">《走秀网用户协议》</a></div>
                </div>
            </div>
            <button class="dl_sm btn btn-info">扫码登录</button>
            <img src="img/ewm_x.png" alt="" class="ewm_x">
            <img src="img/footer0104.jpg" alt="" class="footer0104">
        </div>
    </div>
    <div class="dl3">
        <div class="container ">
            <div class="dl3_a">
                <p><a href="">关于走秀</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">媒体报道</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">品牌招商</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">加入走秀</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">友情链接</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">联系我们</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">帮助中心</a>&nbsp;&nbsp;|&nbsp;&nbsp;
                <a href="">网站地图</a></p>
            </div>
            <div class="dl3_b">
                <p>Copyright © 2008-2018 <a href="">Xiu.com</a> 版权所有 . 粤ICP备07502993号<a href=""><img src="img/footer0401.png" width="14" height="14">粤公网安备 44030402000804号</a>
                </p>
            </div>
        </div>
    </div>
    <script>
        jQuery(function($){
            $(".dl_zc").on('click',function(){
                $(".wangji").show();
            }) 
            $a=''; 
            $(".tijiao1").on('click',function(){ 
                console.log(0)
                $a=$(".username_zh").val();
                $b=$(".phone_zh").val();
                console.log($a)
                console.log($b)

                $.ajax({
                        type:'POST',
                        data:`username=${$a}&phone=${$b}`,
                        url:'api/zhaohui.php',
                        success:function(res){ 
                            console.log(1)
                            let confirm = JSON.parse(res);
                            console.log(confirm.data1)
                            console.log(confirm.data2)
                            if(confirm.data1.length==0||confirm.data2.length==0){
                                console.log(1231)
                                $(".logints").text('账号或手机号错误') ;
                                return;
                            }else if(confirm.data1[0].id==confirm.data2[0].id){
                                    $(".username_zh").hide();
                                    $(".phone_zh").hide();
                                    $(".npsd1").show()
                                    $(".npsd2").show()
                                    $(".tijiao1").hide();
                                    $(".tijiao2").show()
                            }else{
                                    $(".logints").text('账号或手机号错误')       
                            }
                        }
                    });
            }) 
            $(".tijiao2").on('click',function(){ 
                $c=$(".npsd1").val();
                $d=$(".npsd1").val();
                console.log($c)
                console.log($d)
                if($c!=$d){
                    $(".logints").text('两次密码不一致') ;
                    return;
                }
                $.ajax({
                        type:'POST',
                        data:`username=${$a}&pad=${$d}`,
                        url:'api/shezhimima.php',
                        success:function(res){ 
                            alert("密码设置成功，请重新登录")
                            $(".wangji").hide();
                            window.location.href = window.location.href;
                        }

                })

            })
        $(".guanbi").on("click",function(){
            $(".wangji").hide();
        })
            




            $(".dxdl").on('click',function(){
                $(".dxdl").parent().next().show();
                $(".dxdl").parent().next().next().hide();
                $(".dxdl").addClass("dl_act");
                $(".mmdl").removeClass("dl_act");
                $(".dl_btn").html("注&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;册")

            })
            $(".mmdl").on('click',function(){
                $(".mmdl").parent().next().hide();
                $(".mmdl").parent().next().next().show();
                $(".mmdl").addClass("dl_act");
                $(".dxdl").removeClass("dl_act");
                $(".dl_btn").html("登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;录")
            })
            $(".dl_sm").on("click",function(){
                $(".dl_sm").next().next().show(500).on("click",function(){
                    $(this).hide(500);
                });
            })
            // $(".dl_zc").on('click',function(){
            //     console.log(00)
            //     $(".dxdl").parent().next().show();
            //     $(".dxdl").parent().next().next().hide();
            //     $(".dxdl").addClass("dl_act");
            //     $(".mmdl").removeClass("dl_act");
            //     $(".dl_btn").html("注&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;册")
            // })
            $(".dl_zc").on('click',function(){
                console.log(00)
                

            })



        });
    </script>
</body>
</html>
<script>
    document.addEventListener('DOMContentLoaded',()=>{
			let username = document.querySelector('.phone');
			let password = document.querySelector('.msg');
			let btnReg = document.querySelector('.dl_btn');
			let status = [200,304];
		// 设置参数，记录用户名的状态
			let isok = false;
            // console.log(1);
// 验证用户名====================================================
			username.onblur = ()=>{
            console.log(2);
				let _username = username.value;
			// 发起请求==========================
				let xhr = new XMLHttpRequest();		
				xhr.onload = ()=>{
                    // console.log(3);
					if(status.indexOf(xhr.status) >= 0){
                        // console.log(4);
						var formGroup = username.parentNode;
						console.log(xhr.responseText);
						if(xhr.responseText === 'yes'){
							isok = true;
							username.nextElementSibling.innerText = '';
						}else if(xhr.responseText === 'no'){
							isok = false;
							username.nextElementSibling.nextElementSibling.innerText = '用户名已存在'; 
						}
					}
				}
			// 带入用户名参数
				xhr.open('get','api/check_username.php?username='+_username,true);
				xhr.send();
			}
// 注册，写入数据库====================================================
			btnReg.onclick = ()=>{
				if(!isok){	return false;	}
				let _username = username.value;
				var _password = password.value;
                if(_username==""){
                    alert("请输入需要注册的账号")
                    return;
                }else if(_username.length<6||_password.length<6){
                    alert("你太短")
                    return;
                }
			// 发起请求=========================
				let xhr = new XMLHttpRequest();
				xhr.onload = ()=>{
					if(status.indexOf(xhr.status) >= 0){
						console.log(xhr.responseText);
					}
				}
			// 设置参数，发起post请求，参数不在url中
				xhr.open('post','api/reg.php',true);
			// 固定搭配，设置请求头，以便后端接收post数据
				xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
			// 发送请求，带入参数，注意表达式name=value&name=value
				xhr.send(`username=${_username}&password=${_password}`);
                document.write("注册成功,三秒后自动返回首页");
                setTimeout(function(){window.location.href = `shouye2.html?username=${_username}`;},3000)
			}
           
// 登录 
            jQuery(function($){


                $hs =function(){
            // 获取值
                    let $loginusername = $('.dl_usm').val();
                    let $loginpwd = $('.psd').val();
                    let $worning = $('.yincang');
                    console.log($loginusername,$loginpwd)
                    if($('.dl_usm').val()===""){
                        $worning.text('请输入账号');
                        return;
                    }
                    if($('.psd').val()===""){
                        $worning.text('请输入密码');
                        return;
                    }
            // 发送请求
                    $.ajax({
                        type:'POST',
                        data:`loginusername=${$loginusername}&loginpwd=${$loginpwd}`,
                        url:'api/login.php',
                        success:function(res){  
                            let confirm = JSON.parse(res);

                            if(confirm.data1.length==0||confirm.data2.length==0){
                                console.log(1231)
                                $worning.text('账号或密码输入错误') ;
                                return;
                            }else if(confirm.data1[0].id==confirm.data2[0].id){
                                        window.location.href = `shouye2.html?username=${$loginusername}`
                            }else{
                                    $worning.text('账号或密码输入错误')       
                            }
                        }
                    });
                }


        // 点击登录
                $('.dl_btn').on('click',$hs);


        // enter登录
                $("input"). keydown(function(e){
                    e= e ||window.event;
                    var key = e.keyCode || e.which;
                    console.log(key)
                    if(key === 13){
                        $hs();
                    }
                }) 

        //找回密码
                $('.dl_usm').on('input',function(){
                    $('.yincang').html('');
                }) 



            })
            
        });            
</script>